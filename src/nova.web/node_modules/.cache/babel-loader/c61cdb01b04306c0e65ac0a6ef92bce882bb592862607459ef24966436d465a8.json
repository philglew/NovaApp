{"ast":null,"code":"/*! @azure/msal-browser v3.28.0 2024-12-12 */\n'use strict';\n\nimport { createBrowserAuthError } from '../error/BrowserAuthError.mjs';\nimport { PerformanceEvents } from '@azure/msal-common/browser';\nimport { KEY_FORMAT_JWK } from '../utils/BrowserConstants.mjs';\nimport { urlEncodeArr } from '../encode/Base64Encode.mjs';\nimport { nonBrowserEnvironment, cryptoNonExistent } from '../error/BrowserAuthErrorCodes.mjs';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\n/**\r\n * This file defines functions used by the browser library to perform cryptography operations such as\r\n * hashing and encoding. It also has helper functions to validate the availability of specific APIs.\r\n */\n/**\r\n * See here for more info on RsaHashedKeyGenParams: https://developer.mozilla.org/en-US/docs/Web/API/RsaHashedKeyGenParams\r\n */\n// RSA KeyGen Algorithm\nconst PKCS1_V15_KEYGEN_ALG = \"RSASSA-PKCS1-v1_5\";\n// SHA-256 hashing algorithm\nconst S256_HASH_ALG = \"SHA-256\";\n// MOD length for PoP tokens\nconst MODULUS_LENGTH = 2048;\n// Public Exponent\nconst PUBLIC_EXPONENT = new Uint8Array([0x01, 0x00, 0x01]);\n// UUID hex digits\nconst UUID_CHARS = \"0123456789abcdef\";\n// Array to store UINT32 random value\nconst UINT32_ARR = new Uint32Array(1);\nconst SUBTLE_SUBERROR = \"crypto_subtle_undefined\";\nconst keygenAlgorithmOptions = {\n  name: PKCS1_V15_KEYGEN_ALG,\n  hash: S256_HASH_ALG,\n  modulusLength: MODULUS_LENGTH,\n  publicExponent: PUBLIC_EXPONENT\n};\n/**\r\n * Check whether browser crypto is available.\r\n */\nfunction validateCryptoAvailable() {\n  if (!window) {\n    throw createBrowserAuthError(nonBrowserEnvironment);\n  }\n  if (!window.crypto) {\n    throw createBrowserAuthError(cryptoNonExistent);\n  }\n  if (!window.crypto.subtle) {\n    throw createBrowserAuthError(cryptoNonExistent, SUBTLE_SUBERROR);\n  }\n}\n/**\r\n * Returns a sha-256 hash of the given dataString as an ArrayBuffer.\r\n * @param dataString {string} data string\r\n * @param performanceClient {?IPerformanceClient}\r\n * @param correlationId {?string} correlation id\r\n */\nasync function sha256Digest(dataString, performanceClient, correlationId) {\n  performanceClient === null || performanceClient === void 0 || performanceClient.addQueueMeasurement(PerformanceEvents.Sha256Digest, correlationId);\n  const encoder = new TextEncoder();\n  const data = encoder.encode(dataString);\n  return window.crypto.subtle.digest(S256_HASH_ALG, data);\n}\n/**\r\n * Populates buffer with cryptographically random values.\r\n * @param dataBuffer\r\n */\nfunction getRandomValues(dataBuffer) {\n  return window.crypto.getRandomValues(dataBuffer);\n}\n/**\r\n * Returns random Uint32 value.\r\n * @returns {number}\r\n */\nfunction getRandomUint32() {\n  window.crypto.getRandomValues(UINT32_ARR);\n  return UINT32_ARR[0];\n}\n/**\r\n * Creates a UUID v7 from the current timestamp.\r\n * Implementation relies on the system clock to guarantee increasing order of generated identifiers.\r\n * @returns {number}\r\n */\nfunction createNewGuid() {\n  const currentTimestamp = Date.now();\n  const baseRand = getRandomUint32() * 0x400 + (getRandomUint32() & 0x3ff);\n  // Result byte array\n  const bytes = new Uint8Array(16);\n  // A 12-bit `rand_a` field value\n  const randA = Math.trunc(baseRand / 2 ** 30);\n  // The higher 30 bits of 62-bit `rand_b` field value\n  const randBHi = baseRand & 2 ** 30 - 1;\n  // The lower 32 bits of 62-bit `rand_b` field value\n  const randBLo = getRandomUint32();\n  bytes[0] = currentTimestamp / 2 ** 40;\n  bytes[1] = currentTimestamp / 2 ** 32;\n  bytes[2] = currentTimestamp / 2 ** 24;\n  bytes[3] = currentTimestamp / 2 ** 16;\n  bytes[4] = currentTimestamp / 2 ** 8;\n  bytes[5] = currentTimestamp;\n  bytes[6] = 0x70 | randA >>> 8;\n  bytes[7] = randA;\n  bytes[8] = 0x80 | randBHi >>> 24;\n  bytes[9] = randBHi >>> 16;\n  bytes[10] = randBHi >>> 8;\n  bytes[11] = randBHi;\n  bytes[12] = randBLo >>> 24;\n  bytes[13] = randBLo >>> 16;\n  bytes[14] = randBLo >>> 8;\n  bytes[15] = randBLo;\n  let text = \"\";\n  for (let i = 0; i < bytes.length; i++) {\n    text += UUID_CHARS.charAt(bytes[i] >>> 4);\n    text += UUID_CHARS.charAt(bytes[i] & 0xf);\n    if (i === 3 || i === 5 || i === 7 || i === 9) {\n      text += \"-\";\n    }\n  }\n  return text;\n}\n/**\r\n * Generates a keypair based on current keygen algorithm config.\r\n * @param extractable\r\n * @param usages\r\n */\nasync function generateKeyPair(extractable, usages) {\n  return window.crypto.subtle.generateKey(keygenAlgorithmOptions, extractable, usages);\n}\n/**\r\n * Export key as Json Web Key (JWK)\r\n * @param key\r\n */\nasync function exportJwk(key) {\n  return window.crypto.subtle.exportKey(KEY_FORMAT_JWK, key);\n}\n/**\r\n * Imports key as Json Web Key (JWK), can set extractable and usages.\r\n * @param key\r\n * @param extractable\r\n * @param usages\r\n */\nasync function importJwk(key, extractable, usages) {\n  return window.crypto.subtle.importKey(KEY_FORMAT_JWK, key, keygenAlgorithmOptions, extractable, usages);\n}\n/**\r\n * Signs given data with given key\r\n * @param key\r\n * @param data\r\n */\nasync function sign(key, data) {\n  return window.crypto.subtle.sign(keygenAlgorithmOptions, key, data);\n}\n/**\r\n * Returns the SHA-256 hash of an input string\r\n * @param plainText\r\n */\nasync function hashString(plainText) {\n  const hashBuffer = await sha256Digest(plainText);\n  const hashBytes = new Uint8Array(hashBuffer);\n  return urlEncodeArr(hashBytes);\n}\nexport { createNewGuid, exportJwk, generateKeyPair, getRandomValues, hashString, importJwk, sha256Digest, sign, validateCryptoAvailable };","map":{"version":3,"names":["PKCS1_V15_KEYGEN_ALG","S256_HASH_ALG","MODULUS_LENGTH","PUBLIC_EXPONENT","Uint8Array","UUID_CHARS","UINT32_ARR","Uint32Array","SUBTLE_SUBERROR","keygenAlgorithmOptions","name","hash","modulusLength","publicExponent","validateCryptoAvailable","window","createBrowserAuthError","nonBrowserEnvironment","crypto","cryptoNonExistent","subtle","sha256Digest","dataString","performanceClient","correlationId","addQueueMeasurement","PerformanceEvents","Sha256Digest","encoder","TextEncoder","data","encode","digest","getRandomValues","dataBuffer","getRandomUint32","createNewGuid","currentTimestamp","Date","now","baseRand","bytes","randA","Math","trunc","randBHi","randBLo","text","i","length","charAt","generateKeyPair","extractable","usages","generateKey","exportJwk","key","exportKey","KEY_FORMAT_JWK","importJwk","importKey","sign","hashString","plainText","hashBuffer","hashBytes","urlEncodeArr"],"sources":["C:\\temp\\NovaApp\\src\\nova.web\\node_modules\\@azure\\msal-browser\\src\\crypto\\BrowserCrypto.ts"],"sourcesContent":["/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport {\n    createBrowserAuthError,\n    BrowserAuthErrorCodes,\n} from \"../error/BrowserAuthError.js\";\nimport {\n    IPerformanceClient,\n    PerformanceEvents,\n} from \"@azure/msal-common/browser\";\nimport { KEY_FORMAT_JWK } from \"../utils/BrowserConstants.js\";\nimport { urlEncodeArr } from \"../encode/Base64Encode.js\";\n\n/**\n * This file defines functions used by the browser library to perform cryptography operations such as\n * hashing and encoding. It also has helper functions to validate the availability of specific APIs.\n */\n\n/**\n * See here for more info on RsaHashedKeyGenParams: https://developer.mozilla.org/en-US/docs/Web/API/RsaHashedKeyGenParams\n */\n// RSA KeyGen Algorithm\nconst PKCS1_V15_KEYGEN_ALG = \"RSASSA-PKCS1-v1_5\";\n// SHA-256 hashing algorithm\nconst S256_HASH_ALG = \"SHA-256\";\n// MOD length for PoP tokens\nconst MODULUS_LENGTH = 2048;\n// Public Exponent\nconst PUBLIC_EXPONENT: Uint8Array = new Uint8Array([0x01, 0x00, 0x01]);\n// UUID hex digits\nconst UUID_CHARS = \"0123456789abcdef\";\n// Array to store UINT32 random value\nconst UINT32_ARR = new Uint32Array(1);\n\nconst SUBTLE_SUBERROR = \"crypto_subtle_undefined\";\n\nconst keygenAlgorithmOptions: RsaHashedKeyGenParams = {\n    name: PKCS1_V15_KEYGEN_ALG,\n    hash: S256_HASH_ALG,\n    modulusLength: MODULUS_LENGTH,\n    publicExponent: PUBLIC_EXPONENT,\n};\n\n/**\n * Check whether browser crypto is available.\n */\nexport function validateCryptoAvailable(): void {\n    if (!window) {\n        throw createBrowserAuthError(\n            BrowserAuthErrorCodes.nonBrowserEnvironment\n        );\n    }\n    if (!window.crypto) {\n        throw createBrowserAuthError(BrowserAuthErrorCodes.cryptoNonExistent);\n    }\n    if (!window.crypto.subtle) {\n        throw createBrowserAuthError(\n            BrowserAuthErrorCodes.cryptoNonExistent,\n            SUBTLE_SUBERROR\n        );\n    }\n}\n\n/**\n * Returns a sha-256 hash of the given dataString as an ArrayBuffer.\n * @param dataString {string} data string\n * @param performanceClient {?IPerformanceClient}\n * @param correlationId {?string} correlation id\n */\nexport async function sha256Digest(\n    dataString: string,\n    performanceClient?: IPerformanceClient,\n    correlationId?: string\n): Promise<ArrayBuffer> {\n    performanceClient?.addQueueMeasurement(\n        PerformanceEvents.Sha256Digest,\n        correlationId\n    );\n    const encoder = new TextEncoder();\n    const data = encoder.encode(dataString);\n    return window.crypto.subtle.digest(\n        S256_HASH_ALG,\n        data\n    ) as Promise<ArrayBuffer>;\n}\n\n/**\n * Populates buffer with cryptographically random values.\n * @param dataBuffer\n */\nexport function getRandomValues(dataBuffer: Uint8Array): Uint8Array {\n    return window.crypto.getRandomValues(dataBuffer);\n}\n\n/**\n * Returns random Uint32 value.\n * @returns {number}\n */\nfunction getRandomUint32(): number {\n    window.crypto.getRandomValues(UINT32_ARR);\n    return UINT32_ARR[0];\n}\n\n/**\n * Creates a UUID v7 from the current timestamp.\n * Implementation relies on the system clock to guarantee increasing order of generated identifiers.\n * @returns {number}\n */\nexport function createNewGuid(): string {\n    const currentTimestamp = Date.now();\n    const baseRand = getRandomUint32() * 0x400 + (getRandomUint32() & 0x3ff);\n\n    // Result byte array\n    const bytes = new Uint8Array(16);\n    // A 12-bit `rand_a` field value\n    const randA = Math.trunc(baseRand / 2 ** 30);\n    // The higher 30 bits of 62-bit `rand_b` field value\n    const randBHi = baseRand & (2 ** 30 - 1);\n    // The lower 32 bits of 62-bit `rand_b` field value\n    const randBLo = getRandomUint32();\n\n    bytes[0] = currentTimestamp / 2 ** 40;\n    bytes[1] = currentTimestamp / 2 ** 32;\n    bytes[2] = currentTimestamp / 2 ** 24;\n    bytes[3] = currentTimestamp / 2 ** 16;\n    bytes[4] = currentTimestamp / 2 ** 8;\n    bytes[5] = currentTimestamp;\n    bytes[6] = 0x70 | (randA >>> 8);\n    bytes[7] = randA;\n    bytes[8] = 0x80 | (randBHi >>> 24);\n    bytes[9] = randBHi >>> 16;\n    bytes[10] = randBHi >>> 8;\n    bytes[11] = randBHi;\n    bytes[12] = randBLo >>> 24;\n    bytes[13] = randBLo >>> 16;\n    bytes[14] = randBLo >>> 8;\n    bytes[15] = randBLo;\n\n    let text = \"\";\n    for (let i = 0; i < bytes.length; i++) {\n        text += UUID_CHARS.charAt(bytes[i] >>> 4);\n        text += UUID_CHARS.charAt(bytes[i] & 0xf);\n        if (i === 3 || i === 5 || i === 7 || i === 9) {\n            text += \"-\";\n        }\n    }\n    return text;\n}\n\n/**\n * Generates a keypair based on current keygen algorithm config.\n * @param extractable\n * @param usages\n */\nexport async function generateKeyPair(\n    extractable: boolean,\n    usages: Array<KeyUsage>\n): Promise<CryptoKeyPair> {\n    return window.crypto.subtle.generateKey(\n        keygenAlgorithmOptions,\n        extractable,\n        usages\n    ) as Promise<CryptoKeyPair>;\n}\n\n/**\n * Export key as Json Web Key (JWK)\n * @param key\n */\nexport async function exportJwk(key: CryptoKey): Promise<JsonWebKey> {\n    return window.crypto.subtle.exportKey(\n        KEY_FORMAT_JWK,\n        key\n    ) as Promise<JsonWebKey>;\n}\n\n/**\n * Imports key as Json Web Key (JWK), can set extractable and usages.\n * @param key\n * @param extractable\n * @param usages\n */\nexport async function importJwk(\n    key: JsonWebKey,\n    extractable: boolean,\n    usages: Array<KeyUsage>\n): Promise<CryptoKey> {\n    return window.crypto.subtle.importKey(\n        KEY_FORMAT_JWK,\n        key,\n        keygenAlgorithmOptions,\n        extractable,\n        usages\n    ) as Promise<CryptoKey>;\n}\n\n/**\n * Signs given data with given key\n * @param key\n * @param data\n */\nexport async function sign(\n    key: CryptoKey,\n    data: ArrayBuffer\n): Promise<ArrayBuffer> {\n    return window.crypto.subtle.sign(\n        keygenAlgorithmOptions,\n        key,\n        data\n    ) as Promise<ArrayBuffer>;\n}\n\n/**\n * Returns the SHA-256 hash of an input string\n * @param plainText\n */\nexport async function hashString(plainText: string): Promise<string> {\n    const hashBuffer: ArrayBuffer = await sha256Digest(plainText);\n    const hashBytes = new Uint8Array(hashBuffer);\n    return urlEncodeArr(hashBytes);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}